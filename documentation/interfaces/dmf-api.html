<!DOCTYPE html>
<html>
  <!--Head section for CSS/Javascript  -->

<head>
  <meta charset="utf-8">
  <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
  <meta name="description" content="IoT Software Update">
  <meta name="author" content="">
  <!--base to have relative path for offline navigation -->





  <title>Eclipse hawkBit - IoT Software Update</title>

  <!--Stylesheets-->
  <!-- Bootstrap 3.3.1 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <!-- Font Awesome Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="../../css/prettyPhoto.css" type="text/css" media="screen" title="prettyPhoto main stylesheet" charset="utf-8" />
  <!-- Custom CSS -->
  <link href="../../css/hawkbit.css" rel="stylesheet">

  <!--Javascript-->
  <!-- JQuery 2.1.1-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <!-- Bootstrap 3.3.1 JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.1/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="../../js/jquery.prettyPhoto.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">
               $(document).ready(function(){
                 $("a[rel^='prettyPhoto']").prettyPhoto();
               });
             </script>
</head>

  <body>
    <!--Header section Site navigation -->

<!--base to have relative path for offline navigation -->





<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container">
				<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="../../index.html">Eclipse hawkBit™</a>
				</div>
				<div class="collapse navbar-collapse wow fadeIn" id="navbar-collapse" data-wow-delay="0.2s">
						<ul class="nav navbar-nav pull-right">
							
								<li >
									
										<a href="../../news/index.html">News</a>

									
								</li>
							
								<li >
									
										<a href="../../blog/index.html">Blog</a>

									
								</li>
							
								<li >
									
										<a href="../../documentation/overview/introduction.html">Documentation</a>

									
								</li>
							
						</ul>
				</div>
				<!-- /.navbar-collapse -->
		</div>
		<style>#forkongithub a{background:#8d0c0c;color:#fff;text-decoration:none;font-family:Arial, Helvetica, sans-serif;text-align:center;font-weight:bold;padding:5px 40px;font-size:12px;line-height:3rem;position:relative;transition:0.5s;}#forkongithub a:hover{background:#c11;color:#fff;}#forkongithub a::before,#forkongithub a::after{content:"";width:100%;display:block;position:absolute;top:1px;left:0;height:1px;background:#fff;}#forkongithub a::after{bottom:1px;top:auto;}@media screen and (min-width:800px){#forkongithub{position:fixed;display:block;top:0;right:0;width:50px;overflow:visible;height:200px;z-index:9999;}#forkongithub a{width:260px;position:absolute;top:40px;right:-60px;transform:rotate(45deg);-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);}}</style><span id="forkongithub"><a href="https://github.com/eclipse/hawkbit">Fork me on GitHub</a></span>
		<!-- /.container -->
</nav>

    <div id="header_wrapper" class="container">
      <div class="nav-bar col-md-3">
        <nav class="navmenu navmenu-default"  role="navigation">
          <ul class="nav navmenu-nav">
            <!--base to have relative path for offline navigation -->






  
    <li>
      Introduction
      <ul class="nav navmenu-nav">
        <!-- 2nd level -->
        <!--base to have relative path for offline navigation -->






  
    <li  >
      
        <a href="../../documentation/overview/introduction.html">Overview</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/overview/features.html">Features</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/overview/getting-started.html">Getting Started</a>
      

    </li>
  


      </ul>
    </li>
  

  
    <li>
      Concepts
      <ul class="nav navmenu-nav">
        <!-- 2nd level -->
        <!--base to have relative path for offline navigation -->






  
    <li  >
      
        <a href="../../documentation/architecture/architecture.html">Architecture</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/architecture/datamodel.html">Data model</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/architecture/targetstate.html">Target States</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/architecture/rollout-management.html">Rollout Management</a>
      

    </li>
  


      </ul>
    </li>
  

  
    <li>
      Interfaces
      <ul class="nav navmenu-nav">
        <!-- 2nd level -->
        <!--base to have relative path for offline navigation -->






  
    <li  >
      
        <a href="../../documentation/interfaces/interfaces.html">Overview</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/interfaces/management-ui.html">Management UI</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/interfaces/management-api.html">Management API</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/interfaces/ddi-api.html">DDI API</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/interfaces/dmf-api.html">DMF API</a>
      

    </li>
  


      </ul>
    </li>
  

  
    <li>
      Security
      <ul class="nav navmenu-nav">
        <!-- 2nd level -->
        <!--base to have relative path for offline navigation -->






  
    <li  >
      
        <a href="../../documentation/security/security.html">Overview</a>
      

    </li>
  


      </ul>
    </li>
  

  
    <li>
      Guides
      <ul class="nav navmenu-nav">
        <!-- 2nd level -->
        <!--base to have relative path for offline navigation -->






  
    <li  >
      
        <a href="../../documentation/guide/runhawkbit.html">Build and Run hawkBit</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/guide/clustering.html">Clustering</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/guide/customtheme.html">Theme Customization</a>
      

    </li>
  

  
    <li  >
      
        <a href="../../documentation/guide/feignclient.html">Create Feign Client</a>
      

    </li>
  


      </ul>
    </li>
  


          </ul>
      </nav>
    </div>


    <div id="page" class="col-md-9">
    	<div class="inner">
        <div id="maincontainer">
          <section id="top" class="documentation-section">
            <div class="row">
					     <div class="span8 offset3">
                 <!--base to have relative path for offline navigation -->

<p>Currently bodies of messages are based on JSON. The DMF API provides java classes which allows that the message body can be deserialized at runtime into a java object. Also java classes can be used to serialize java objects into JSON bodies to send a message to <em>hawkBit</em>.</p>

<h2 id="basics">Basics</h2>

<p>There are three basic concepts of AMQP:</p>

<ul>
  <li>Exchanges - what you publish to.</li>
  <li>Queues - what you consume from.</li>
  <li>Bindings - configuration that maps an exchange to a queue.</li>
</ul>

<p><strong>Queues</strong> are just a place for receiving messages.  
Bindings determine how messages get put in this place
Queues can also be bound to multiple exchanges.  </p>

<p><strong>Exchanges</strong> are just publish messages.
The user decides who can produce on an exchange and who can create bindings on that exchange for delivery to a specific queue.</p>

<p><em>hawkBit</em> will create all necessary queues, exchanges and bindings for the user, making it easy to get started.
The exchange name for outgoing messages is <strong>dmf.exchange</strong>.
The queue name for incoming messages is <strong>sp_direct_queue</strong>. Unless a <code>reply_to</code> header is set, <em>hawkBit</em> will reply on the <strong>sp.direct.exchange</strong> which is bound to the <strong>sp_direct_queue</strong>.</p>

<p>The user can set a <code>reply_to</code> header (see chapter below), to change the default sender exchange.</p>

<p>The following chapter describes the message body, header and properties.</p>

<p>Note: the DMF protocol was intended to be open for other non update use cases by design (e.g. <a href="https://github.com/eclipse/hono">Eclipse Hono</a>. As a result, DMF uses the term <strong>thing</strong> and not <strong>target</strong> but they are actually synonyms in this case.</p>

<h2 id="messages-sent-to-hawkbit">Messages sent to <em>hawkBit</em></h2>
<p>All messages have to be sent to the exchange <strong>dmf.exchange</strong>.</p>

<h3 id="message-to-register-a-thing">Message to register a thing</h3>

<table>
  <thead>
    <tr>
      <th>Message Header</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type</td>
      <td>Type of the message</td>
      <td>Fixed string “THING_CREATED “</td>
      <td>true</td>
    </tr>
    <tr>
      <td>thingId</td>
      <td>The ID of the registered thing</td>
      <td>String</td>
      <td>true</td>
    </tr>
    <tr>
      <td>sender</td>
      <td>Name of the message sender</td>
      <td>String</td>
      <td>false</td>
    </tr>
    <tr>
      <td>tenant</td>
      <td>The tenant this thing belongs to</td>
      <td>String</td>
      <td>false</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Message Properties</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>content_type</td>
      <td>The content type of the payload</td>
      <td>String</td>
      <td>true</td>
    </tr>
    <tr>
      <td>reply_to</td>
      <td>Exchange to reply to. The default is sp.direct.exchange which is bound to the sp_direct_queue</td>
      <td>String</td>
      <td>false</td>
    </tr>
  </tbody>
</table>

<p><strong>Example Header</strong></p>

<table>
  <thead>
    <tr>
      <th>Headers</th>
      <th>MessageProperties</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type=THING_CREATED <br /> tenant=tenant123 <br /> thingId=abc  <br /> sender=Lwm2m</td>
      <td>content_type=application/json <br /> reply_to (optional) =sp.connector.replyTo</td>
    </tr>
  </tbody>
</table>

<h3 id="message-to-update-target-attributes">Message to update target attributes</h3>

<table>
  <thead>
    <tr>
      <th>Message Header</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type</td>
      <td>Type of the message</td>
      <td>Fixed string “EVENT”</td>
      <td>true</td>
    </tr>
    <tr>
      <td>topic</td>
      <td>Topic to handle events different</td>
      <td>Fixed string “UPDATE_ATTRIBUTES”</td>
      <td>true</td>
    </tr>
    <tr>
      <td>thingId</td>
      <td>The ID of the registered thing</td>
      <td>String</td>
      <td>true</td>
    </tr>
    <tr>
      <td>tenant</td>
      <td>The tenant this thing belongs to</td>
      <td>String</td>
      <td>false</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Message Properties</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>content_type</td>
      <td>The content type of the payload</td>
      <td>String</td>
      <td>true</td>
    </tr>
  </tbody>
</table>

<p><strong>Example Header and Payload</strong></p>

<table>
  <thead>
    <tr>
      <th>Headers</th>
      <th>MessageProperties</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type=EVENT <br /> tenant=tenant123 <br /> thingId=abc  <br /> topic=UPDATE_ATTRIBUTES</td>
      <td>content_type=application/json <br /></td>
    </tr>
  </tbody>
</table>

<p>Payload Template</p>

<pre><code class="language-json">{
	"attributes": {
		"exampleKey1" : "exampleValue1",
		"exampleKey2" : "exampleValue2"
	}
}
</code></pre>

<h3 id="message-to-send-an-action-status-event-to-hawkbit">Message to send an action status event to <em>hawkBit</em></h3>

<p>The Java representation is ActionUpdateStatus:</p>

<table>
  <thead>
    <tr>
      <th>Header</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type</td>
      <td>Type of the message</td>
      <td>Fixed string “EVENT”</td>
      <td>true</td>
    </tr>
    <tr>
      <td>topic</td>
      <td>Topic to handle events different</td>
      <td>Fixed string “UPDATE_ACTION_STATUS”</td>
      <td>true</td>
    </tr>
    <tr>
      <td>tenant</td>
      <td>The tenant this thing belongs to</td>
      <td>String</td>
      <td>false</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Message Properties</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>content_type</td>
      <td>The content type of the payload</td>
      <td>String</td>
      <td>true</td>
    </tr>
  </tbody>
</table>

<p>Payload Template</p>

<pre><code class="language-json">{
"actionId": long,
"softwareModuleId": long,
"actionStatus":"String",
"message":["String"]
}
</code></pre>
<p>Possible actionStatus</p>

<table>
  <thead>
    <tr>
      <th>Header</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DOWNLOAD</td>
      <td>Device is downloading</td>
    </tr>
    <tr>
      <td>RETRIEVED</td>
      <td>Device management service has retrieved something</td>
    </tr>
    <tr>
      <td>RUNNING</td>
      <td>Update is running</td>
    </tr>
    <tr>
      <td>FINISHED</td>
      <td>Update process finished successful</td>
    </tr>
    <tr>
      <td>ERROR</td>
      <td>Error during update process</td>
    </tr>
    <tr>
      <td>WARNING</td>
      <td>Warning during update process</td>
    </tr>
    <tr>
      <td>CANCELED</td>
      <td>Cancel update process successful</td>
    </tr>
    <tr>
      <td>CANCEL_REJECTED</td>
      <td>Cancel update process has been rejected</td>
    </tr>
  </tbody>
</table>

<p><strong>Example Header and Payload</strong></p>

<table>
  <thead>
    <tr>
      <th>Headers</th>
      <th>MessageProperties</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type=EVENT  <br /> tenant=tenant123 <br /> topic=UPDATE_ACTION_STATUS</td>
      <td>content_type=application/json</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-json">{
"actionId":137,
"softwareModuleId":17,
"actionStatus":"DOWNLOAD",
"message":["The download has started"]
}
</code></pre>

<h3 id="message-to-cancel-an-update-task">Message to cancel an update task</h3>

<table>
  <thead>
    <tr>
      <th>Header</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type</td>
      <td>Type of the message</td>
      <td>Fixed string “Event”</td>
      <td>true</td>
    </tr>
    <tr>
      <td>thingId</td>
      <td>The ID of the registered thing</td>
      <td>String</td>
      <td>true</td>
    </tr>
    <tr>
      <td>topic</td>
      <td>Topic to handle events different</td>
      <td>Fixed string “CANCEL_DOWNLOAD”</td>
      <td>true</td>
    </tr>
    <tr>
      <td>tenant</td>
      <td>The tenant this thing belongs to</td>
      <td>String</td>
      <td>false</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Message Properties</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>content_type</td>
      <td>The content type of the payload</td>
      <td>String</td>
      <td>true</td>
    </tr>
  </tbody>
</table>

<p><strong>Example Header</strong></p>

<table>
  <thead>
    <tr>
      <th>Headers</th>
      <th>MessageProperties</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type=EVENT <br /> tenant=tenant123 <br /> thingId=abc  <br /> topic=CANCEL_DOWNLOAD</td>
      <td>content_type=application/json</td>
    </tr>
  </tbody>
</table>

<p>After this message has been sent, an action status event with either actionStatus=CANCELED or actionStatus=CANCEL_REJECTED has to be returned.</p>

<p><strong>Example Header and Payload when cancellation is successful</strong></p>

<table>
  <thead>
    <tr>
      <th>Headers</th>
      <th>MessageProperties</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type=EVENT  <br /> tenant=tenant123 <br /> topic=UPDATE_ACTION_STATUS</td>
      <td>content_type=application/json</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-json">{
"actionId":137,
"softwareModuleId":17,
"actionStatus":"CANCELED",
"message":["The update was canceled."]
}
</code></pre>

<p><strong>Example Header and Payload when cancellation was rejected</strong></p>

<table>
  <thead>
    <tr>
      <th>Headers</th>
      <th>MessageProperties</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type=EVENT  <br /> tenant=tenant123 <br /> topic=UPDATE_ACTION_STATUS</td>
      <td>content_type=application/json</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-json">{
"actionId":137,
"softwareModuleId":17,
"actionStatus":"CANCEL_REJECTED",
"message":["The cancellation was not possible since the target sent an unexpected response."]
}
</code></pre>
<p>## Messages sent by <em>hawkBit</em>
All messages from <em>hawkBit</em> will be sent to the <strong>sp_direct_queue</strong> or the one specified in the <code>reply_to</code> property.</p>

<h3 id="message-sent-by-hawkbit-to-initialize-an-update-task">Message sent by <em>hawkBit</em> to initialize an update task</h3>

<table>
  <thead>
    <tr>
      <th>Header</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type</td>
      <td>Type of the message</td>
      <td>Fixed string “EVENT”</td>
      <td>true</td>
    </tr>
    <tr>
      <td>thingId</td>
      <td>The ID of the registered thing</td>
      <td>String</td>
      <td>true</td>
    </tr>
    <tr>
      <td>topic</td>
      <td>Topic to handle events different</td>
      <td>Fixed string “DOWNLOAD_AND_INSTALL”</td>
      <td>true</td>
    </tr>
    <tr>
      <td>tenant</td>
      <td>The tenant this thing belongs to</td>
      <td>String</td>
      <td>false</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Message Properties</th>
      <th>Description</th>
      <th>Type</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>content_type</td>
      <td>The content type of the payload</td>
      <td>String</td>
      <td>true</td>
    </tr>
  </tbody>
</table>

<p>The Java representation is DownloadAndUpdateRequest:</p>

<p>Payload Template</p>

<pre><code class="language-json">{
"actionId": long,
"targetSecurityToken": "String",
"softwareModules":[
    {
    "moduleId": long,
    "moduleType":"String",
    "moduleVersion":"String",
    "artifacts":[
        {
        "filename":"String",
        "urls":{
            "HTTP":"String",
            "HTTPS":"String"
            },
        "hashes":{
            "md5":"String",
            "sha1":"String"
            },
        "size":long
        }]
    }]
}
</code></pre>

<p><strong>Example Header and Payload</strong></p>

<table>
  <thead>
    <tr>
      <th>Headers</th>
      <th>MessageProperties</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type=EVENT  <br /> tenant=tenant123 <br /> thingId=abc  <br /> topic=DOWNLOAD_AND_INSTALL</td>
      <td>content_type=application/json</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-json">{
"actionId":137,
"targetSecurityToken":"bH7XXAprK1ChnLfKSdtlsp7NOlPnZAYY",
"softwareModules":[
    {
    "moduleId":7,
    "moduleType":"firmware",
    "moduleVersion":"7.7.7",
    "artifacts":[
        {
        "filename":"artifact.zip",
        "urls":{
            "HTTP":"http://download-from-url.com",
            "HTTPS":"https://download-from-url.com"
            },
        "hashes":{
            "md5":"md5hash",
            "sha1":"sha1hash"
            },
        "size":512
        }]
    }]
}
</code></pre>

                </div>
             </div>
          </section>
        </div>
      </div>
    </div>
  </div>
    <!-- Footer -->
<footer>
   <div class="container">
   <div class="row">
         <div class="col-md-4">
           <h3 class="footer-links-header">Quick Links</h3>
           <ul class="footer-links clearfix">
             <li><a href="http://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li>
             <li><a href="http://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
             <li><a href="http://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
             <li><a href="http://www.eclipse.org/legal/">Legal</a></li>
           </ul>
           <ul class="footer-links clearfix">
             <li><a href="http://www.eclipse.org">Eclipse Home</a></li>
             <li><a href="http://marketplace.eclipse.org/">Market Place</a></li>
             <li><a href="http://live.eclipse.org/">Eclipse Live</a></li>
             <li><a href="http://www.planeteclipse.org/">Eclipse Planet</a></li>
           </ul>
           </div>
         <div class="col-md-2">
          
   </div>
</footer>

<!--/.Footer-->

  </body>

</html>
